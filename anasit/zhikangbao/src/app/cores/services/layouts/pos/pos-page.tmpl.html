<md-card style="padding:0;margin:0">
    <md-card-content>
        <div class="content-padded">
            <h2 class="md-title">
                {{vm.posStatus.title}}
                <md-button ng-click="vm.posStatus.backToWhole()" id="returnRoWholeBtn" class="md-raised md-primary">返回</md-button>
            </h2>
        </div>
        <md-divider></md-divider>
        <div layout layout-sm="column" flex>
            <md-input-container flex>
                <label>组织类型</label>
                <md-select class="md-select-form" ng-model="currentOrgCate" ng-change="getOrgList()" placeholder="组织类型">
                    <md-option ng-value="org.id" ng-repeat="org in orgCateList">{{org.name}}</md-option>
                </md-select>
            </md-input-container>
            <md-input-container flex>
                <label>机构/社区/组织</label>
                <md-select class="md-select-form" ng-model="currentOrg" ng-change="getOldManTrip()" placeholder="机构/社区/组织列表">
                    <md-option ng-value="org.id" ng-repeat="org in orgList">{{org.full_name}}</md-option>
                </md-select>
            </md-input-container>
            <md-input-container flex>
                <label>根据设备序列号或手机号回车搜索</label>
                <input ng-keyup="vm.startSearch($event)" ng-model="vm.search.content" type="text">
            </md-input-container>
        </div>
        
        <style type="text/css">
    
            #amap-container {
                width: 100%;
                height: 400px;
            }

            #returnRoWholeBtn {
                display: none;
            }

        </style>

        <div id="amap-container"></div>

<!--         <button ng-click="startAnimation()">start</button>
        <button ng-click="stopAnimation()">stop</button>
 -->    
    </md-card-content>
</md-card>

<script type="text/javascript">

    window.historyPolyLine = [];
    
    var followUp = function(mobile) {
        if(mobile == null) {
            alert('参数错误');
            return false;
        }

        for (var i = markerStack.length - 1; i >= 0; i--) {
            if(markerStack[i].Rd.position === currentMarker.target.Rd.position){
                continue;
            }
            markerStack[i].setMap(null);
        };

        infoWindow.close();
        $('#returnRoWholeBtn').show();
        ServicesPosVM.posStatus.title = "位置信息追踪";
    }

    function hideAllpolyLine() {
        for (var i = 0; i < historyPolyLine.length; i++) {
            var curr = historyPolyLine[i];
            curr.setMap(null);
        };
        historyPolyLine = [];
    }

    function clearMap() {
        for (var i = markerStack.length - 1; i >= 0; i--) {
            markerStack[i].setMap();
        };
        hideAllpolyLine();
        markerStack = [];
        TotalLnglats = [];
    }

    var followHistory = function() {

        hideAllpolyLine();

        var lineArr = [];

        var lngX = 111.47;
        var latY = 27.25;
        var lineArr = [];
        lineArr.push([lngX, latY]);

        for (var i = 1; i < 100; i++) {
          lngX = lngX + Math.random() * 0.05;
          if (i % 2) {
            latY = latY + Math.random() * 0.0001;
          } else {
            latY = latY + Math.random() * 0.06;
          }
          lineArr.push([lngX, latY]);
        }

        var polyline = new AMap.Polyline({
            map: map,
            path: lineArr,
            strokeColor: "#00A",  //线颜色
            strokeOpacity: 1,     //线透明度
            strokeWeight: 3,      //线宽
            strokeStyle: "solid"  //线样式
        });

        console.log(polyline);

        historyPolyLine.push(polyline);

        map.setFitView();

        var markerPerson = new AMap.Marker({
            map: map,
            position: [111.47, 27.25],
            icon: "https://cdn0.iconfinder.com/data/icons/user-pictures/100/matureman2-48.png",
            offset: new AMap.Pixel(-26, -13),
            autoRotation: true
        });

        markerPerson.moveAlong(lineArr, 500);//开始动画
    }

</script>
